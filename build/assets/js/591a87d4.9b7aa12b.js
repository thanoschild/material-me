"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[232],{4988:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>n,metadata:()=>a,toc:()=>c});var o=r(4848),s=r(8453);const n={sidebar_position:1},i="BigQuery",a={id:"Google-Cloud-Platform/database-services/bigquery",title:"BigQuery",description:"BigQuery\u2019s serverless architecture decouples storage and computing and allows them to scale independently on demand, which offers both immense flexibility and cost controls for customers.",source:"@site/docs/Google-Cloud-Platform/database-services/bigquery.md",sourceDirName:"Google-Cloud-Platform/database-services",slug:"/Google-Cloud-Platform/database-services/bigquery",permalink:"/docs/Google-Cloud-Platform/database-services/bigquery",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Google-Cloud-Platform/database-services/bigquery.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Cloud Function",permalink:"/docs/Google-Cloud-Platform/compute-engines/cloud-function"},next:{title:"Docker",permalink:"/docs/category/docker"}},l={},c=[{value:"Capacitor (columnar format)",id:"capacitor-columnar-format",level:3},{value:"Colossus (storage)",id:"colossus-storage",level:3},{value:"Dremel (execution engine)",id:"dremel-execution-engine",level:3},{value:"Borg (compute)",id:"borg-compute",level:3},{value:"Jupiter (network)",id:"jupiter-network",level:3}];function d(e){const t={h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"bigquery",children:"BigQuery"})}),"\n",(0,o.jsx)(t.p,{children:"BigQuery\u2019s serverless architecture decouples storage and computing and allows them to scale independently on demand, which offers both immense flexibility and cost controls for customers."}),"\n",(0,o.jsx)("img",{src:"/img/gcp-docs/bigquery-architecture.png",alt:"BigQuery Architecture"}),"\n",(0,o.jsx)(t.p,{children:"BigQuery employs a vast set of multi-tenant services like Dremel, Colossus, Jupiter and Borg."}),"\n",(0,o.jsx)(t.h3,{id:"capacitor-columnar-format",children:"Capacitor (columnar format)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"BigQuery stores data in a columnar storage format called Capacitor. The capacitor allows BQ to store and efficiently query semi-structured data with nested and repeated fields. Each column in a BQ table is stored in a separate Capacitor file, which enables high compression ratios and fast scan throughput. Capacitor allows BQ to directly operate on compressed data without the need to decompress it on the fly."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The capacitor encodes each column by collecting statistics about the data and storing two numbers, called the definition and repetition levels, in addition to the column\u2019s value. These statistics are used during query execution to optimize the query plan and choose the most efficient runtime algorithms. Once all of the column data has been encoded, it is encrypted and written to Colossus."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"BigQuery is primarily designed for read-only use cases because its columnar storage format does not allow for updates to existing records."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"colossus-storage",children:"Colossus (storage)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"BigQuery leverages the columnar storage format and compression algorithm to store data in Colossus, optimized for reading large amounts of structured data."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Colossus, Google\u2019s latest-generation distributed file system, is designed to be reliable and fault-tolerant. It replaced the previous Google File System (GFS) and is capable of handling cluster-wide replication, recovery from disk crashes, and distributed management."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"dremel-execution-engine",children:"Dremel (execution engine)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Dremel turns SQL queries into execution trees. The leaves of the tree are called slots and do the heavy lifting of reading data from storage and any necessary computation. The branches of the tree are \u2018mixers\u2019, which perform the aggregation."}),"\n"]}),"\n",(0,o.jsx)("img",{src:"/img/gcp-docs/dremel.png",alt:"Dremel",style:{display:"block",margin:"0 auto"}}),"\n",(0,o.jsx)(t.p,{children:"Let\u2019s understand the query execution with a simple example:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"A user submits a query to BigQuery, such as SELECT COUNT(*) FROM mytable WHERE timestamp > \u20182021\u201301\u201301\u2019."}),"\n",(0,o.jsx)(t.li,{children:"The query is received by the root node of the Dremel serving tree, which is the starting point for query execution."}),"\n",(0,o.jsx)(t.li,{children:"The root node routes the query to the intermediate nodes (or mixers) of the serving tree. These nodes perform query optimization and rewrite the query to include horizontal partitions of the table and partial aggregation and filtering."}),"\n",(0,o.jsx)(t.li,{children:"In this example, the query optimizer might decide to partition the table based on the timestamp column and only include the partitions that have timestamps greater than \u20182021\u201301\u201301\u2019."}),"\n",(0,o.jsx)(t.li,{children:"The intermediate nodes then send the rewritten query to the leaf nodes for execution. The leaf nodes read the relevant partitions of the table from Colossus and perform the filters and final aggregation specified in the query."}),"\n",(0,o.jsx)(t.li,{children:"In this example, the leaf nodes would count the number of rows in the partitions that have timestamps greater than \u20182021\u201301\u201301\u2019 and return the result to the intermediate nodes."}),"\n",(0,o.jsx)(t.li,{children:"The intermediate nodes then pass the results back up the serving tree to the root node, which returns the final result of the query, such as \u201cCOUNT(*) = 1000000\u201d, to the user."}),"\n",(0,o.jsx)(t.li,{children:"The query optimizer ensures that the query can be executed within the constraints of the system and also that it\u2019s the most efficient way to execute the query."}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"borg-compute",children:"Borg (compute)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Borg is Google\u2019s large-scale cluster management system. Borg simultaneously runs thousands of Dremel jobs across one or more clusters made up of tens of thousands of machines. In addition to assigning compute capacity for Dremel jobs, Borg handles fault tolerance."}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"jupiter-network",children:"Jupiter (network)"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"BigQuery requires an ultra-fast network which can deliver terabytes of data in seconds directly from storage into compute for running Dremel jobs. Google\u2019s Jupiter network enables BigQuery service to utilize 1 Petabit/sec of total bisection bandwidth."}),"\n"]}),"\n",(0,o.jsx)("img",{src:"/img/gcp-docs/bigquery-architecture2.png",alt:"Dremel",style:{display:"block",margin:"0 auto"}})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>i,x:()=>a});var o=r(6540);const s={},n=o.createContext(s);function i(e){const t=o.useContext(n);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(n.Provider,{value:t},e.children)}}}]);